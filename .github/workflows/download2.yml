name: Download and Release (Multi-threaded)

on:
  workflow_dispatch:

jobs:
  download_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v5

      - name: Install aria2
        run: sudo apt-get update && sudo apt-get install -y aria2

      - name: Multi-threaded Download
        env:
          SP_COOKIE: ${{ secrets.QQ }}
        run: |
          echo "--- 开始多线程下载 ---"
          URL="https://multimedia.qfile.qq.com/download?appid=14901&client_type=web&client_ver=8.9.25&fileid=EhTUgsZtYt-QnTVTr28YypkCnuP4dBjqlPKsCyC1dCjc56Gyx4aSAzIEcHJvZFCA6klaEOUbeF65cDYBlZCalx90CgJ6A0pb_4IBAmd6&fldc=-b8AHWhyUkMt0T8UcuzZsNubU0B6hpsnaiAEU2-CYUBrC8DZzjCf4Pt0_F0tdhH9FkDmbFQEdFiB_oAGFH6yd-gtWN8VhKDwMPI7A9WUnQ4BjAoJW4JBAg8J75XcOiSZUjI7TGt1erbsbcjYo3YC9RCSp1wJQMcjOU3X8uqWFBEiG1JMyF4C9Cw&rkey=CAQSqAGZmA0fLi93qAXbotiM9LvAc6UXBawb5wHqccrF_LYLHeHZa_zmjuQie1on-xiWJSgenGH5X94U1NsmB9SfgFdwYYMc-S_qK0jeR2cPZWjfof-3QrwEhSBOXGTEb3OVKsfG7lXIaGYpz7kKo5d_t1J5b_K1uLLGkdCS8YOWqe5ZRx5fxv_1Z4A2GBdtn21Ao0zKPBMd1twgpFZFL-wm8a4asbbOCBcBfe4&filename=MovieData.zip"

          # -x 16 表示使用 16 个线程
          aria2c -x 16 -s 16 \
                 --header="Cookie: $SP_COOKIE" \
                 --user-agent="Mozilla/5.0" \
                 "$URL"

          echo "--- 下载完成，查看文件 ---"
          ls -lh

      - name: Create Release and Upload
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "downloadmm-v${{ github.run_number }}"
          name: "Download vm${{ github.run_number }}"
          body: |
            ## 多线程下载完成
            - 自动获取文件名，无需手动指定。
          files: ./*
