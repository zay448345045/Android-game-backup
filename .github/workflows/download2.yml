name: Download and Release (Fixed)

on:
  workflow_dispatch:

jobs:
  download_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v5

      - name: Install aria2
        run: sudo apt-get update && sudo apt-get install -y aria2

      - name: Multi-threaded Download
        env:
          SP_COOKIE: ${{ secrets.QQ }}
        run: |
          mkdir -p ./output
          URL="https://multimedia.qfile.qq.com/download?appid=14901&client_type=web&client_ver=8.9.25&fileid=EhTUgsZtYt-QnTVTr28YypkCnuP4dBjqlPKsCyC1dCjc56Gyx4aSAzIEcHJvZFCA6klaEOUbeF65cDYBlZCalx90CgJ6A0pb_4IBAmd6&fldc=JS8WkPRp-vNodw0H5zPbklmFbAaZoqC7EgpwK0WyB6WDewy9f4UYgTVCY_dFIe_bdoy68Og0VguUzwQKqRZcO-utet1I5qTe-WYV2nicRqA3sNp92_gGP-WzLpsakqGkT-FTcuIkK_U0012VcHYdEzbIo1hjzuO1c2adruxPx8AppwPwePJXPkw&rkey=CAMSqAGmgtos7rOgmux-xY-LcKgtmLgfR90VUpLQbqht0767s_4k1awkJtKRa93nG-Mrja8_0Esdkds57Oku6GZaivLiNHWs4SVZGNQn8FcSSzvKnL9ljPk9wSamqtF0006YpPoBKpFpV8n53XVQbvm4r4xrqFaLbYm2KnbH_A1eNucCFSChQxc7byrwIGZAhFeZmHhFdnAHQlyDVWYleT-AW2XBmEMS4Rm1vDo&filename=MovieData.zip"
          
          # 建议增加 -o 指定保存名称，并下载到 output 目录
          aria2c -x 16 -s 16 -d ./output -o MovieData.zip \
                 --header="Cookie: $SP_COOKIE" \
                 --user-agent="Mozilla/5.0" \
                 "$URL"

      - name: Create Release and Upload
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "v${{ github.run_number }}"
          name: "Release v${{ github.run_number }}"
          # 只上传 output 目录下的 zip 文件
          files: ./output/MovieData.zip
