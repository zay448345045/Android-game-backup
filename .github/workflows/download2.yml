name: Download and Release (Fixed)

on:
  workflow_dispatch:

jobs:
  download_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v5

      - name: Install aria2
        run: sudo apt-get update && sudo apt-get install -y aria2

      - name: Multi-threaded Download
        env:
          SP_COOKIE: ${{ secrets.QQ }}
        run: |
          mkdir -p ./output
          URL="https://multimedia.qfile.qq.com/download?appid=14901&client_type=web&client_ver=8.9.25&fileid=EhTUgsZtYt-QnTVTr28YypkCnuP4dBjqlPKsCyC1dCjc56Gyx4aSAzIEcHJvZFCA6klaEOUbeF65cDYBlZCalx90CgJ6A0pb_4IBAmd6&fldc=OWeLRTt3eMCQKn_3aOJj5EAz7TEbA29NKmHtmpjYFtclMoGtUvCWhBGM9fVdpVvxWOOypJpL1NVA3aNITFtzXAB0e_qC2epJvVUL58tBi0oX_U_w3znuDSVMe2o8ztDSErVsN4kK8yOdzUPc9Qnqb1Orlkm9iNFizlpDTaB05jUAHTF-Nxo696o&rkey=CAMSqAGmgtos7rOgmux-xY-LcKgt6qXLjq7k1eXzgCoWz7x615bc40l1EgVpOww8lwhzZg_bf_7Jtv4_nJOZ9_PqeHkPAsTgIVUCKblIkkU8GrYFw5tM1Zu9auHzoP0Fp_kEDl581v5fJ5xh1hOa7163FyiN8tcfEDgag_goxHKx_K3Vsf5pxBUAglWIDfD0SRIio6S75Xh1KxrVl-Z4i1rApyjnp_ygiPrAQP0&filename=MovieData.zip"
          
          # 建议增加 -o 指定保存名称，并下载到 output 目录
          aria2c -x 16 -s 16 -d ./output -o MovieData.zip \
                 --header="Cookie: $SP_COOKIE" \
                 --user-agent="Mozilla/5.0" \
                 "$URL"

      - name: Create Release and Upload
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "v${{ github.run_number }}"
          name: "Release v${{ github.run_number }}"
          # 只上传 output 目录下的 zip 文件
          files: ./output/MovieData.zip
